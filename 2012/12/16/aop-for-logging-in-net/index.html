<!DOCTYPE html><html><head><meta charset="utf-8"><title>AOP for logging in .NET - Hari Menon</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="UPDATE (02&#x2F;24&#x2F;2013):I did manage to figure out (thanks to Jon Skeet answering my question on SO) how to tackle the async&#x2F;await scenario for a AOP logger using StructureMap and DynamicProxy. Check out"><meta property="og:type" content="article"><meta property="og:title" content="AOP for logging in .NET"><meta property="og:url" content="https://harimenon.com/2012/12/16/aop-for-logging-in-net/index.html"><meta property="og:site_name" content="Hari Menon"><meta property="og:description" content="UPDATE (02&#x2F;24&#x2F;2013):I did manage to figure out (thanks to Jon Skeet answering my question on SO) how to tackle the async&#x2F;await scenario for a AOP logger using StructureMap and DynamicProxy. Check out"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2012-12-17T00:23:00.000Z"><meta property="article:modified_time" content="2021-01-01T06:02:35.376Z"><meta property="article:author" content="Hari Menon"><meta property="article:tag" content=".NET"><meta property="article:tag" content="oss"><meta property="article:tag" content="cross-cutting concerns"><meta property="article:tag" content="aspect oriented programming"><meta property="article:tag" content="StructureMap"><meta property="article:tag" content="instrumentation"><meta property="article:tag" content="logging"><meta property="article:tag" content="Castle Dynamic Proxy"><meta property="article:tag" content="tracing"><meta property="article:tag" content="AOP"><meta property="article:tag" content="log4net"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://harimenon.com/2012/12/16/aop-for-logging-in-net/"><link rel="alternative" href="/atom.xml" title="Hari Menon" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="//cdn.jsdelivr.net/smc-webfonts/latest/fonts/manjari.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"><link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css"><link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css"><link href="/css/fonts/css/all.min.css" rel="stylesheet" type="text/css"><link href="/css/fonts/css/v4-shims.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-4869398-4","auto"),ga("send","pageview")</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="container"><header id="header"><div id="header-outer" class="outer"><div id="header-inner" class="inner"><a id="main-nav-toggle" class="fas nav-icon" href="javascript:;"></a> <a id="logo" class="logo" href="/"></a><nav id="main-nav"><a class="main-nav-link" href="/"><i title="Home" class="fa fa-home fa-2x fa-fw"><span class="nav-text">Home</span></i></a> <a class="main-nav-link" href="/about"><i title="About Me" class="fa fa-user-circle fa-2x fa-fw"><span class="nav-text">About Me</span></i></a> <a class="main-nav-link" href="/archives"><i title="Archives" class="fa fa-archive fa-2x fa-fw"><span class="nav-text">Archives</span></i></a> <a class="main-nav-link" href="/categories"><i title="Categories" class="fa fa-folder-open fa-2x fa-fw"><span class="nav-text">Categories</span></i></a> <a class="main-nav-link" href="/tags"><i title="Tags" class="fa fa-tags fa-2x fa-fw"><span class="nav-text">Tags</span></i></a> <a class="main-nav-link" href="/atom.xml"><i title="RSS" class="fa fa-rss fa-2x fa-fw"><span class="nav-text">RSS</span></i></a></nav><nav id="sub-nav"><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://harimenon.com"></form></div></nav></div></div></header><section id="main" class="outer"><article id="post-aop-for-logging-in-net" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">AOP for logging in .NET</h1></header><div class="article-meta"><a href="/2012/12/16/aop-for-logging-in-net/" class="article-date"><time datetime="2012-12-17T00:23:00.000Z" itemprop="datePublished">2012-12-16</time></a><div class="article-category"><a class="article-category-link" href="/categories/technical/">technical</a></div></div><div class="article-entry" itemprop="articleBody"><blockquote><p><strong>UPDATE (02/24/2013):</strong><br>I did manage to figure out (thanks to Jon Skeet <a target="_blank" rel="noopener" href="http://stackoverflow.com/a/14288190/218882">answering</a> my question on SO) how to tackle the async/await scenario for a AOP logger using StructureMap and DynamicProxy. Check out <del><a target="_blank" rel="noopener" href="https://github.com/floydpink/LoggerPoc/tags">the tag v0.2</a></del> <a target="_blank" rel="noopener" href="https://github.com/floydpink/LoggerPoc/tags">the tag v0.3</a> <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> on GitHub for the source.</p></blockquote><p>Implementing the <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Aspect-oriented_programming">AOP pattern</a> into a C# .NET application is something I always wanted to do. I had tried PostSharp with a few other team members, a while ago, but could not get it working soon enough, that we quit the attempt after a while.</p><p>After reading up a little more (<a target="_blank" rel="noopener" href="http://docs.castleproject.org/Default.aspx?Page=Introduction-to-AOP-With-Castle&amp;NS=Windsor&amp;AspxAutoDetectCookieSupport=1">here</a>, <a target="_blank" rel="noopener" href="http://weblogs.asp.net/thangchung/archive/2011/01/25/aop-with-structuremap-container.aspx">here</a> and <a target="_blank" rel="noopener" href="http://ayende.com/blog/3474/logging-the-aop-way">here</a>) I am now trying it all over again in the <a target="_blank" rel="noopener" href="http://flickrdownloadr.com/">flickr downloadr</a> that I am now working on.</p><p>I still haven’t completely cracked it, because the Flickr Downloadr WPF app heavily uses the new asynchrony features (async/await etc.) from .NET 4.5. I hope to somehow adapt the dynamic proxy based intercept paradigm to make it work with the new asynchronous model soonand I shall follow this up here then with the details.</p><a id="more"></a><p>Meanwhile, here’s <a target="_blank" rel="noopener" href="https://github.com/floydpink/LoggerPoc/tags">the solution on GitHub (as tag v0.1)</a> that is a proof-of-concept console app, which calls into two separate service classes. As long as there are no asynchrony features from .NET. 4.5 in your app, you should be able to make use of this pattern.</p><p>There is some business specific logging (what I call organic logging )happening inside one of these service classes themselves. But there is also code enables aop logging of all the entry and exit into every method in these pseudo- business objects.</p><p>The main method that does the AOP magic is the Intercept method of the IInterceptor interface.</p><script src="//gist.github.com/4315686.js"></script><p>It could peep into the method being called, its arguments, its return type etc. through the invocation instance, do things like logging and then make the real call to the real invocation. The try/catch that is implemented at this level could be the only place that happens. Auditing, authentication etc. could also be implemented at this layer to affect all the classes/methods one chooses.</p><div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none;padding-left:0"><li id="fn:1"><span style="display:inline-block;vertical-align:top;padding-right:10px">1.</span><span style="display:inline-block;vertical-align:top"><small>[updated: 03/25/2014]</small></span><a href="#fnref:1" rev="footnote"> ↩</a></li></ol></div></div></div><footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/net/" rel="tag">.NET</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aop/" rel="tag">AOP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/castle-dynamic-proxy/" rel="tag">Castle Dynamic Proxy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/structuremap/" rel="tag">StructureMap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/aspect-oriented-programming/" rel="tag">aspect oriented programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cross-cutting-concerns/" rel="tag">cross-cutting concerns</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/instrumentation/" rel="tag">instrumentation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log4net/" rel="tag">log4net</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logging/" rel="tag">logging</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oss/" rel="tag">oss</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tracing/" rel="tag">tracing</a></li></ul></footer></div><nav id="article-nav"><a href="/2013/01/15/single-click-deployment/" id="article-nav-newer" class="article-nav-link-wrap"><div class="article-nav-title"><span>&lt;</span>&nbsp; Single-click Deployment of WPF Application to GitHub Pages</div></a><a href="/2012/12/07/lzwCompress.js/" id="article-nav-older" class="article-nav-link-wrap"><div class="article-nav-title">Compressing JSON - lzwCompress.js&nbsp;<span>&gt;</span></div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><footer id="footer"><div class="outer"><div id="footer-info" class="inner" title="Generated on 20210101 010331">Copyright &copy; 2009 - 2021 Hari Menon&nbsp;| Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></div></div></footer><script>var disqus_shortname="harimenonenglishblog",disqus_url="https://harimenon.com/2012/12/16/aop-for-logging-in-net/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body></html>