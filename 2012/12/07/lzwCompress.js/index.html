<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>Compressing JSON - lzwCompress.js - Hari Menon</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="The application that I am working on now is a nice little ASP.NET MVC4 web app, whose target audience will access it on some of the popular tablets of the day - iPad, Android and Windows 8 Surface etc"><meta name="keywords" content="JavaScript,indexedDb,lzwCompress.js,JSON Key Optimization,JSON Compression,compressing JSON,webSql database,oss"><meta property="og:type" content="article"><meta property="og:title" content="Compressing JSON - lzwCompress.js"><meta property="og:url" content="https://harimenon.com/2012/12/07/lzwCompress.js/index.html"><meta property="og:site_name" content="Hari Menon"><meta property="og:description" content="The application that I am working on now is a nice little ASP.NET MVC4 web app, whose target audience will access it on some of the popular tablets of the day - iPad, Android and Windows 8 Surface etc"><meta property="og:locale" content="en"><meta property="og:updated_time" content="2019-06-03T23:46:08.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Compressing JSON - lzwCompress.js"><meta name="twitter:description" content="The application that I am working on now is a nice little ASP.NET MVC4 web app, whose target audience will access it on some of the popular tablets of the day - iPad, Android and Windows 8 Surface etc"><link rel="canonical" href="https://harimenon.com/2012/12/07/lzwcompress.js/"><link rel="alternative" href="/atom.xml" title="Hari Menon" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="//cdn.jsdelivr.net/smc-webfonts/latest/fonts/manjari.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"><link href="/webfonts/ptserif/main.css" rel="stylesheet" type="text/css"><link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css"><link href="/css/fonts/css/all.min.css" rel="stylesheet" type="text/css"><link href="/css/fonts/css/v4-shims.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-4869398-4","auto"),ga("send","pageview")</script></head></html><body><div id="container"><header id="header"><div id="header-outer" class="outer"><div id="header-inner" class="inner"><a id="main-nav-toggle" class="fas nav-icon" href="javascript:;"></a> <a id="logo" class="logo" href="/"></a><nav id="main-nav"><a class="main-nav-link" href="/"><i title="Home" class="fa fa-home fa-2x fa-fw"><span class="nav-text">Home</span></i></a> <a class="main-nav-link" href="/about"><i title="About Me" class="fa fa-user-circle fa-2x fa-fw"><span class="nav-text">About Me</span></i></a> <a class="main-nav-link" href="/archives"><i title="Archives" class="fa fa-archive fa-2x fa-fw"><span class="nav-text">Archives</span></i></a> <a class="main-nav-link" href="/categories"><i title="Categories" class="fa fa-folder-open fa-2x fa-fw"><span class="nav-text">Categories</span></i></a> <a class="main-nav-link" href="/tags"><i title="Tags" class="fa fa-tags fa-2x fa-fw"><span class="nav-text">Tags</span></i></a> <a class="main-nav-link" href="/atom.xml"><i title="RSS" class="fa fa-rss fa-2x fa-fw"><span class="nav-text">RSS</span></i></a></nav><nav id="sub-nav"><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://harimenon.com"></form></div></nav></div></div></header><section id="main" class="outer"><article id="post-lzwCompress.js" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Compressing JSON - lzwCompress.js</h1></header><div class="article-meta"><a href="/2012/12/07/lzwCompress.js/" class="article-date"><time datetime="2012-12-07T08:36:00.000Z" itemprop="datePublished">2012-12-07</time></a><div class="article-category"><a class="article-category-link" href="/categories/technical/">technical</a></div></div><div class="article-entry" itemprop="articleBody"><p>The application that I am working on now is a nice little ASP.NET MVC4 web app, whose target audience will access it on some of the popular tablets of the day - iPad, Android and Windows 8 Surface etc.!</p><p>The USP of the otherwise regular data entry app is that it has an offline mode, so that the data collection can happen even when there is no connectivity. Even with ubiquity of the data networks, this proved to be the critical aspect of the app for the client. And among the things being cached for offline mode, there is some really hefty business look-up/metadata, that has to be there for the app to function. The fact that the app would be targeting multiple devices, and because the HTML5 recommended <a href="http://www.w3.org/TR/IndexedDB/" target="_blank" rel="noopener">IndexedDB API</a> is still not implemented by some of the major players (Opera or Safari or any iOS6 browser), we had to fall back to the better/older/more-robust and now-deprecated <a href="http://www.w3.org/TR/webdatabase/" target="_blank" rel="noopener">Web SQL database</a> as well.</p><a id="more"></a><p>The app would be online, when certain business entities would get enabled for offline mode, and this is when it takes down the metadata in JSON format, to the device-supported offline database. And because this data was pretty big (approximately 15 meg per entity), this offline-enabling itself was consuming quite a bit of space. And that was just the set up with the static look up data. The main point of the app, once again, is that it helps adding transactions/entities to the offline-enabled entity, using this look-up data. These transactions again have to go to the same offline databases as JSON, and there could be a couple of hundred of these, on a single device, with almost all of them having one or two (BASE64 encoded JPEG) photos as well.</p><p>Now, at around a few hundred megs of offline data, the browsers start getting less responsive and might even start crashing when visiting pages from that domain (this bit is not confirmed across all the devices/browsers). So the gist is: we had to look into somehow optimizing the data getting stored into the device.</p><p>First thing I looked into was optimizing the redundancy innate to the JSON structure - that of the repeating keys. There were quite a <a href="https://github.com/WebReflection/JSONH" target="_blank" rel="noopener">few</a> such <a href="http://www.cliws.com/e/06pogA9VwXylo_GknPEeFA/" target="_blank" rel="noopener">optimizations</a> on the web and <a href="http://stackoverflow.com/questions/4433402/replace-keys-json-in-javascript" target="_blank" rel="noopener">this Stack Overflow question</a> is what finally I took. That alone shaved off around 20% in average, which was nice but not nearly enough.</p><p>Then I started exploring compression algorithms like gzip or lzw or some other such for compressing the JSON strings. And stumbled on to <a href="http://stackoverflow.com/questions/2252465/javascript-client-data-compression" target="_blank" rel="noopener">this (SO again!)</a>. I started off with the <a href="http://rosettacode.org/wiki/LZW_compression#JavaScript" target="_blank" rel="noopener">JS implementation</a> mentioned in the answer there and enhanced a little bit it to make it do the JSON-key-redundancy optimization as well.</p><p><a href="http://floydpink.github.com/lzwCompress.js/" target="_blank" rel="noopener">lzwCompress.js</a> was the result!</p><p>The simple usage as given in the github readme page is:<script src="//gist.github.com/4230480.js"></script></p><p>All (well, almost all - there are <a href="http://htmlpreview.github.com/?https://github.com/floydpink/lzwCompress.js/blob/master/test/test.html" target="_blank" rel="noopener">a few unit tests</a> that pass) valid JavaScript objects, when applied through the pack and unpack cycled would retain its structure and form. And most of them would have an average compression of 45-80% after the pack, which is what could be used to store to offline databases, maybe sending up to server etc.</p><p>Feel free to use it for anything where you would need compression of your JSON (or any JavaScript) data structures.</p></div><footer class="article-footer"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json-compression/">JSON Compression</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json-key-optimization/">JSON Key Optimization</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compressing-json/">compressing JSON</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/indexeddb/">indexedDb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lzwcompress-js/">lzwCompress.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oss/">oss</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websql-database/">webSql database</a></li></ul></footer></div><nav id="article-nav"><a href="/2012/12/16/aop-for-logging-in-net/" id="article-nav-newer" class="article-nav-link-wrap"><div class="article-nav-title"><span>&lt;</span>&nbsp; AOP for logging in .NET</div></a><a href="/2012/12/06/useful-git-commands/" id="article-nav-older" class="article-nav-link-wrap"><div class="article-nav-title">Useful git commands&nbsp;<span>&gt;</span></div></a></nav></article><section id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></section><footer id="footer"><div class="outer"><div id="footer-info" class="inner" title="Generated on 20190603 194724">Copyright &copy; 2009 - 2019 Hari Menon&nbsp;| Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></div></div></footer><script>var disqus_shortname="harimenonenglishblog",disqus_url="https://harimenon.com/2012/12/07/lzwCompress.js/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body>